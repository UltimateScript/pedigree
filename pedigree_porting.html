<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>The Pedigree Project: Porting Pedigree to New Platforms</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">The Pedigree Project
   &#160;<span id="projectnumber">0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Porting Pedigree to New Platforms </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Pedigree can already run on multiple architectures and hardware platforms, and the work towards making this possible makes porting relatively simple.</p>
<p>Note: the assumption throughout this page is that you are porting to a new architecture and hardware platform at the same time. If you are porting to a target that can use an existing processor or hardware target, you can skip those steps.</p>
<h1><a class="anchor" id="Cross-Compiler"></a>
Cross-Compiler</h1>
<p>This is possibly the most complex part of the porting process. You will need to apply the Pedigree patches to a GCC compiler (ideally in something like a git repository), and then make the needed changes to support the [arch]-pedigree target you wish to add.</p>
<p>Then, you can update the patches with the now-larger diff and build a full toolchain.</p>
<h1><a class="anchor" id="porting_kernel"></a>
src/system/kernel</h1>
<p>See existing implementations in <code>src/system/kernel/core/processor</code> and <code>src/system/kernel/machine</code> for further guidance.</p>
<ul>
<li>Implement the non-inline <a class="el" href="classProcessor.html" title="The exception was caused by a hardware task switch. ">Processor</a> methods for the processor target</li>
<li>Implement <code><a class="el" href="classVirtualAddressSpace.html">VirtualAddressSpace</a></code> with the needed MMU management for your target</li>
<li>Implement assembly stubs as needed for your <a class="el" href="classProcessor.html" title="The exception was caused by a hardware task switch. ">Processor</a> class</li>
<li>Implement the <a class="el" href="classMachine.html">Machine</a> interface for the hardware target</li>
<li>In <code><a class="el" href="Cache_8cc_source.html">src/system/kernel/utilities/Cache.cc</a></code>, add an entry to <code>Cache::Cache()</code> to specify <a class="el" href="classCache.html">Cache</a> virtual address ranges</li>
<li><a class="el" href="system_2kernel_2core_2main_8cc_source.html">src/system/kernel/core/main.cc</a> may need to be updated, depending on your machine and processor target (search the #ifdefs already in the file)</li>
</ul>
<h1><a class="anchor" id="porting_include"></a>
src/system/include</h1>
<p>See existing implementations in <code>src/system/include/processor</code> and <code>src/system/include/machine</code> for further guidance.</p>
<ul>
<li>Implement the inline <code><a class="el" href="classProcessor.html" title="The exception was caused by a hardware task switch. ">Processor</a></code> methods for the processor target</li>
<li>In src/system/include/process/Event.h, set <code>EVENT_BASE</code> for your processor target to an area of the virtual address space that can be used for event handler trampolines (needs 8K of memory)</li>
<li>Add a <code><a class="el" href="classVirtualAddressSpace.html">VirtualAddressSpace</a></code> with a valid memory layout for your target</li>
</ul>
<h1><a class="anchor" id="porting_network_stack"></a>
src/modules/system/network-stack</h1>
<ul>
<li>Update <a class="el" href="NetworkStack_8cc_source.html">src/modules/system/network-stack/NetworkStack.cc</a> to size network memory pools sensibly for the typical target</li>
</ul>
<h1><a class="anchor" id="porting_subsys"></a>
src/subsys</h1>
<ul>
<li>Each subsystem needs to have its relevant syscall headers updated.</li>
</ul>
<h1><a class="anchor" id="porting_build_system"></a>
Build System</h1>
<ul>
<li>Update <code>site_scons/defaults.py</code> to add a section for your architecture target</li>
<li>Update <code>src/system/kernel/SConscript</code> to add the necessary source files for your machine target</li>
<li>Potentially update <code>SConscript</code> in the root directory to add your target to the various <code>if</code> checks that enable builds in parts of the tree</li>
<li>More SConscript files may need to be updated depending on how many features you intend to enable for your target. In particular, SConscript files under <code>src/subsys</code> may need to be edited to enable syscalls for new targets</li>
<li>Create an <code>easy_build_[arch].sh</code> script and enable it via <code>.travis.yml</code> to enable continuous integration via Travis-CI (<a href="https://travis-ci.org">https://travis-ci.org</a>); this will allow your new target to be built at every push and reveal breakage early</li>
<li>If your target can be trivially tested in QEMU, update <code>scripts/runtest.py</code> as well so the continuous integration build will also perform a runtime test</li>
</ul>
<h1><a class="anchor" id="porting_improvements"></a>
Improvements</h1>
<p>The amount of changes needed to make a port is currently rather large and messy, and we want to reduce this to make porting significantly easier. See <a href="https://www.pedigree-project.org/issues/7">https://www.pedigree-project.org/issues/7</a> to track our progress on this. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Jan 24 2020 06:49:09 for The Pedigree Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
