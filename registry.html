<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>The Pedigree Project: Registry</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">The Pedigree Project
   &#160;<span id="projectnumber">0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Registry </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="Introduction"></a>
Introduction</h1>
<p>In order to keep configuration as simple as possible, a "Registry" has been built into Pedigree. While having the same name as the Windows concept, internally it is totally unique.</p>
<p>Configuration is managed by a central manager, which provides a consistent interface that can be used without requiring knowledge of the configuration method. Backends can be plugged in quickly by sub-classing the Backend class, and ensuring the Backend is added to the configuration manager before it is used.</p>
<h1><a class="anchor" id="API"></a>
API</h1>
<p>All configuration Backend classes must subclass <a class="el" href="classConfigurationBackend.html">ConfigurationBackend</a>.</p>
<h2><a class="anchor" id="ConfigurationManager"></a>
ConfigurationManager</h2>
<pre class="fragment">class ConfigurationManager
{
public:
    ConfigurationManager &amp;instance();

    size_t write(String configStore, String Table, String KeyName, String KeyValue, String ValueName, uintptr_t buffer, size_t nBytes);
    size_t read(String configStore, String Table, String KeyName, String KeyValue, String ValueName, uintptr_t buffer, size_t maxBytes);

    bool installBackend(ConfigurationBackend *pBackend, String configStore = "");
    void removeBackend(String configStore);

    bool backendExists(String configStore);
};
</pre><p>This class interface is designed to hide the internal configuration methods from the programmer. The most important concept to grasp is that of the <code>configStore</code> parameters. Each Backend, when installed, specifies a <code>configStore</code> which is used from then on to uniquely identify the Backend. Should <code>configStore</code> not be passed to installBackend, the name of the store will be obtained from the ConfigurationBackend::getConfigStore() method.</p>
<h2><a class="anchor" id="ConfigurationBackend"></a>
ConfigurationBackend</h2>
<pre class="fragment">class ConfigurationBackend
{
public:
    ConfigurationBackend(String configStore);
    virtual ~ConfiguratonBackend();

    virtual size_t write(String Table, String KeyName, String KeyValue, String ValueName, uintptr_t buffer, size_t nBytes);
    virtual size_t read(String Table, String KeyName, String KeyValue, String ValueName, uintptr_t buffer, size_t maxBytes) = 0;

    virtual String getConfigStore();

    virtual String getTypeName();
};
</pre><p>The interface for a <a class="el" href="classConfigurationBackend.html">ConfigurationBackend</a> is relatively simple, as it is merely a layer of abstraction between the <a class="el" href="classConfigurationManager.html">ConfigurationManager</a> and different methods of storing configuration data. It is <em>not</em> compulsory to override <code>write</code>, as the store may be read-only. It is however compulsory to override <code>read</code>. It is not compulsory, but highly recommended for ease of implementation, to override the ConfigurationBackend::getConfigStore() method.</p>
<p>The destructor for <a class="el" href="classConfigurationBackend.html">ConfigurationBackend</a> automatically removes the Backend from the <a class="el" href="classConfigurationManager.html">ConfigurationManager</a>. The constructor will not add the Backend automatically.</p>
<h1><a class="anchor" id="example"></a>
Example Implementation</h1>
<p>To make the concept easier to understand, the following code shows an example of the use of this design. Note that this is more like psuedocode, and it will not compile on Pedigree (due to casting and lack of <a class="el" href="classString.html">String</a> constructor calls, mainly).</p>
<div class="fragment"><div class="line"><span class="comment">// SqlConfigBackend: a ConfigurationBackend for an SQL database</span></div><div class="line"><span class="keyword">class </span>SqlConfigBackend : <span class="keyword">public</span> <a class="code" href="classConfigurationBackend.html">ConfigurationBackend</a></div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    SqlConfigBackend();</div><div class="line">    </div><div class="line">    <span class="comment">// Constructor - defines the database file (uses the name of the database file for configStore)</span></div><div class="line">    SqlConfigBackend(<a class="code" href="classString.html">String</a> fileName);</div><div class="line">    <span class="keyword">virtual</span> ~SqlConfigBackend();</div><div class="line">        </div><div class="line">    <span class="comment">// Runs a query of the form &quot;SELECT valueName FROM Table WHERE keyName=keyValue;&quot;</span></div><div class="line">    <span class="keywordtype">size_t</span> read(<a class="code" href="classString.html">String</a> <a class="code" href="structTable.html">Table</a>, <a class="code" href="classString.html">String</a> KeyName, <a class="code" href="classString.html">String</a> KeyValue, <a class="code" href="classString.html">String</a> ValueName, uintptr_t buffer, <span class="keywordtype">size_t</span> maxBytes);</div><div class="line">    </div><div class="line">    <span class="comment">// Updates the database (will execute an SQL SELECT, then an UPDATE or INSERT query)</span></div><div class="line">    <span class="keywordtype">size_t</span> write(<a class="code" href="classString.html">String</a> <a class="code" href="structTable.html">Table</a>, <a class="code" href="classString.html">String</a> KeyName, <a class="code" href="classString.html">String</a> KeyValue, <a class="code" href="classString.html">String</a> ValueName, uintptr_t buffer, <span class="keywordtype">size_t</span> nBytes);</div><div class="line">    </div><div class="line">    <span class="comment">// Returns &quot;SqlBackend&quot;</span></div><div class="line">    <a class="code" href="classString.html">String</a> getTypeName();</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> <a class="code" href="classRequestQueue.html#aa87ccddad577b380a648dd744e4f7d11">NetworkStack::initialise</a>()</div><div class="line">{</div><div class="line">    ...</div><div class="line"></div><div class="line">    SqlConfigBackend *sqlConfig = <span class="keyword">new</span> SqlConfigBackend(<span class="stringliteral">&quot;root:/config/net-data&quot;</span>);</div><div class="line">    <span class="keywordflow">if</span>(sqlConfig)</div><div class="line">        ConfigurationManager::instance().installBackend(sqlConfig); <span class="comment">// configStore = &quot;net-data&quot;</span></div><div class="line"></div><div class="line">    ...</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> NetworkCard::setStationInfo()</div><div class="line">{</div><div class="line">    ...</div><div class="line"></div><div class="line">    <a class="code" href="classString.html">String</a> Ipv4; <span class="comment">// set above</span></div><div class="line"></div><div class="line">    uint8_t *ipAddr = <span class="keyword">new</span> uint8_t[Ipv4.length() + 1];</div><div class="line">    strcpy(ipAddr, static_cast&lt;const char*&gt;(Ipv4));</div><div class="line"></div><div class="line">    ConfigurationManager::instance().write(<span class="stringliteral">&quot;net-data&quot;</span>, <span class="stringliteral">&quot;interfaces&quot;</span>, <span class="stringliteral">&quot;interface&quot;</span>, <span class="stringliteral">&quot;interface0&quot;</span>, <span class="stringliteral">&quot;ipv4&quot;</span>, ipAddr, Ipv4.length());</div><div class="line"></div><div class="line">    ...</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Jan 24 2020 06:49:09 for The Pedigree Project by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
